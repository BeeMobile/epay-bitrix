Установка:
Папку kkb нужно разместить в {Корневой каталог сайта}/bitrix/php_interface/include/sale_payment/
Файл result_kkb.php нужно вставить в папку {Корневой каталог сайта}/bitrix/tools/
В конец файла {Корневой каталог сайта}/bitrix/php_interface/init.php нужно добавить строку
require_once('include/sale_payment/kkb/init.php');


Настройка:

Заходим Настройки -> Список валют
Добавляем новую валюту тенге (KZT) и редактируем другие настройки валюты.

Перейдем на страницу "Платежные системы" ( "Магазин" -> "Настройки магазина" -> "Платежные системы" )

Нажать на кнопку "Добавить платежную систему"

Заполнить общие данные о платежной системе.

Перейти на нужную вкладку ( "Физические лица" или "Юридические лица" ) и заполнить всю необходимую информацию

Сделать платежную систему активной и нажать "Сохранить"

Включаем тестовую режим и проверяем работу плагина
Для оплаты покупок через тестовую систему надо использовать тестовую карточку.

Имя на карте: любое латиницей
Номер: 4405645000006150
Срок: 09-2015
CVV: 653

Если в тестовом режиме все работает то можно заполнить все остальные данные и отключить тестовый режим
Сертификат ("*.prv") полученный от epay.kkb.kz надо положить в папку data внутри директории плагина


Метод подтверждения платежа
1) Автоматический
Запрос на подтвердения платежа будет отправляться автоматический. Если платеж успешно подтержден, то "Описание статуса платежной системы" заказа выставиться
"Платеж подтержден", если нет то "Сумма блокировано, ждет подтверждения или возврата". Если по каким-то причинам платеж не подтержден, то вам
необходимо вручную потверждать.

2) Ручное
Запрос на подтвердения платежа не будет отправляться автоматический. "Описание статуса платежной системы" заказа выставиться "Сумма блокировано, ждет подтверждения или возврата".
Для подтверждения платежа надо обновить статус заказа "Выполнен" на странице заказа в админке(Магазин - "Заказы").
Для возврата платежа надо выставить галочку "Отменить оплату"  на странице заказа в админке(Магазин - "Заказы" - Оплата - Изменить).


Отладка
Если включен "Логирование", то запросы и ответы kkb будет записоваться в лог файл внутри папки плагина.



ВНИМАНИЕ!

Убедитесь, что директория data из директории плагина защищена от внешнего доступа!
В частности, из браузера не должны быть доступны файлы сертификатов и ключей (ссылки вида http://website.kz/bitrix/php_interface/include/sale_payment/kkb/kkbca.pem) не должны работать.
Если директория data все же доступна, защитите ее средствами веб-сервера или обратитесь в техническую поддержку плагина.
